<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="icon" href="/static/hola.png" type="image/x-icon">
    <title>¡Bienvenido!</title>
    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="/static/style_dashboard.css">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">

    <!-- Librerías JS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>

    <!-- DataTables -->
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

    <!-- Otras librerías -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Scripts locales -->
    <script src="/static/js/inactividad.js"></script>

    <script>
    window.history.forward();
    function noBack() { window.history.forward(); }
    </script>
</head>

<body onload="noBack();" onpageshow="if (event.persisted) noBack();">
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid" id="navbar2">

      <!-- Marca / logo + eslogan -->
      <a class="navbar-brand d-flex align-items-center" href="#">
        <img src="/static/logo.jpg"
             alt="Logo"
             id="icono"
             class="me-2" style="width: 48px; height: 48px; object-fit: contain;">
        <span id="eslogan" class="fw-semibold">Sistema de Control AF</span>
      </a>

      <!-- Botón hamburguesa -->
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
              data-bs-target="#navbarMain" aria-controls="navbarMain"
              aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Contenido colapsable -->
      <div class="collapse navbar-collapse" id="navbarMain">
        <!-- Navegación izquierda -->
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">

          <li class="nav-item">
            <a class="nav-link active" aria-current="page"
               href="#">
              <i class="fa fa-home me-1"></i> Inicio
            </a>
          </li>

          <!-- Dropdown de módulos -->
          <li class="nav-item dropdown">
            <a class="nav-link d-flex align-items-center gap-1" href="#" id="modDropdown"
               role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="fa-solid fa-layer-group me-1"></i> Catálogos
              <i class="fas fa-chevron-down dropdown-arrow"></i>
            </a>
            <ul class="dropdown-menu" aria-labelledby="modDropdown">
              <li><a class="dropdown-item" href="#">Datos Generales</a></li>
              <li><a class="dropdown-item" href="#">Usuarios</a></li>
              <li><a class="dropdown-item" href="#">Proveedores</a></li>
              <li><a class="dropdown-item" href="#">Clientes</a></li>
              <li><a class="dropdown-item" href="#">Categoría</a></li>
              <li><a class="dropdown-item" href="#">Departamento</a></li>
              <li><a class="dropdown-item" href="#">Tipo de Equipo</a></li>
              <li><a class="dropdown-item" href="#">Estado</a></li>
              <li><a class="dropdown-item" href="#">Archivos</a></li>
            </ul>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#"><i class="fa-solid fa-cubes me-1"></i> Control Activo Fijo</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#"><i class="fa-solid fa-file-lines me-1"></i> Expediente Digital</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link d-flex align-items-center gap-1" href="#" id="modDropdown"
               role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="fa-solid fa-chart-column me-1"></i> Reportes
              <i class="fas fa-chevron-down dropdown-arrow"></i>
            </a>
            <ul class="dropdown-menu" aria-labelledby="modDropdown">
              <li><a class="dropdown-item" href="#">General</a></li>
              <li><a class="dropdown-item" href="#">Expediente Digital</a></li>
            </ul>
          </li>
        </ul>

        <!-- Dropdown de usuario (derecha) -->
        <div class="dropdown">
          <button class="btn btn-outline-light dropdown-toggle d-flex align-items-center"
                  type="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            <!-- Avatar SVG / Img -->
            <svg xmlns="http://www.w3.org/2000/svg"
                 viewBox="10 10 77 77"
                 class="me-2" style="width: 32px; height: 32px;">
              <!-- Puedes sustituir por <img> si prefieres -->
              <circle cx="48" cy="48" r="36" fill="#FF0505"></circle>
              <circle cx="48" cy="40" r="12" fill="#fff"></circle>
              <path d="M24,72c6-12,42-12,48,0" fill="#fff"></path>
            </svg>
            <span id="name"><strong>{{ usuario }}
            </strong></span>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
            <li><a class="dropdown-item" href="#"><i class="fa fa-user me-2"></i>Información</a></li>
            <li><hr class="dropdown-divider"></li>
            <li>
              <a class="dropdown-item text-danger" href="{{ url_for('login.logout') }}">
                <i class="fa-solid fa-door-open me-1"></i> Salir
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </nav>

<div class="container mt-4">
    <!-- Indicadores -->
    <div class="row g-4 mb-4">
      <div class="col-md-4">
        <div class="card card-kpi p-3">
          <h5>Días restantes de licencia:</h5>
            {% if dias_restantes is not none %}
            {% if dias_restantes == 0 %}
          <h3 class="text-danger">Licencia expirada</h3>
            {% elif dias_restantes <= 7 %}
          <h3 class="text-warning">{{ dias_restantes }} día{{ 's' if dias_restantes > 1 else '' }} restante{{ 's' if dias_restantes > 1 else '' }}</h3>
            {% else %}
          <h3 class="text-success">{{ dias_restantes }} día{{ 's' if dias_restantes > 1 else '' }} restante{{ 's' if dias_restantes > 1 else '' }}</h3>
            {% endif %}
            {% else %}
            <h3 class="text-muted">Sin licencia válida</h3>
            {% endif %}
        </div>
      </div>
      <div class="col-md-4">
        <div class="card card-kpi p-3">
          <h5>AF próximos a vencer</h5>
          <h3 class="text-danger">12 activos</h3>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card card-kpi p-3">
          <h5>Usuarios activos</h5>
          <h3 class="text-success">45</h3>
        </div>
      </div>
    </div>

    <!-- Gráficas -->
    <div class="row g-4">
      <div class="col-md-6">
        <div class="card p-3">
          <h5 class="text-center">Distribución de Activos</h5>
          <div class="chart-container">
            <canvas id="chartPie"></canvas>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card p-3">
          <h5 class="text-center">Activos por Área</h5>
          <div class="chart-container">
            <canvas id="chartBar"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    function noBack() {
      window.history.forward();
    }
    setTimeout("noBack()", 0);
    window.onunload = function () { null };
  </script>
    <script>
    // Pie Chart
    new Chart(document.getElementById('chartPie'), {
      type: 'pie',
      data: {
        labels: ['Vehículos', 'Maquinaria', 'Equipos', 'Otros'],
        datasets: [{
          data: [30, 25, 20, 25],
          backgroundColor: ['#42a5f5','#66bb6a','#ffa726','#ef5350']
        }]
      }
    });

    // Bar Chart
    new Chart(document.getElementById('chartBar'), {
      type: 'bar',
      data: {
        labels: ['Producción','Ventas','Administración','Logística'],
        datasets: [{
          label: 'Número de Activos',
          data: [12, 19, 7, 14],
          backgroundColor: '#42a5f5'
        }]
      },
      options: {
        scales: { y: { beginAtZero: true } }
      }
    });
  </script>
    <script>
        function salir() {
            Swal.fire({
                icon: 'info',
                title: 'Cerrando sesión...',
                timer: 1000,
                showConfirmButton: false,
                willClose: () => {
                    window.location.href = "{{ url_for('login.logout') }}";
                }
            });
        }
    </script>
<script src="static/js/inactividad.js"></script>
</body>
</html>
